<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="com.austinanimalcenter.shelter.inout.InAndOut">

    <!-- 입양 된 동물 중 보호소 입소 기록이 없는 동물 조회 -->
    <select id="selectNotFoundIntakeInOutcomesAnimal" resultType="java.util.Map">
        SELECT AO.ANIMAL_ID
            , AO.NAME
            FROM (
                SELECT ANIMAL_ID, NAME
                FROM OUTCOMES AS ANIMAL_OUTS
                WHERE NAME IS NOT NULL
                ) AO
            LEFT OUTER JOIN
                (
                SELECT ANIMAL_ID, NAME
                FROM INTAKES AS ANIMAL_INS
                ) AI
            ON AO.ANIMAL_ID = AI.ANIMAL_ID
        WHERE AI.NAME IS NULL
        ORDER BY AO.ANIMAL_ID
        ;
    </select>

    <!-- 입양일이 입소일보다 빠른 입력이 잘못된 데이터 조회 -->
    <select id="selectOutcomeFasterThanIntake" resultType="java.util.Map">
        SELECT AO.ANIMAL_ID, AO.NAME
            FROM (
            SELECT ANIMAL_ID, NAME, DATETIME
            FROM OUTCOMES AS ANIMAL_OUTS
            ) AO
            , (
            SELECT ANIMAL_ID, NAME, DATETIME
            FROM INTAKES AS ANIMAL_INS
            ) AI
        WHERE AO.ANIMAL_ID = AI.ANIMAL_ID
        AND AO.DATETIME <![CDATA[<]]> AI.DATETIME
        ORDER BY AI.DATETIME
        ;
    </select>

</mapper>